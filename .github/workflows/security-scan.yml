name: Security Scan (Legacy)

# NOTE: This workflow has been superseded by security-gating.yml
# It's kept for weekly scheduled scans only
# For PR/push security checks, see .github/workflows/security-gating.yml

on:
  schedule:
    - cron: '0 0 * * 0'  # Weekly
  workflow_dispatch:  # Manual trigger

jobs:
  scan:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v3

      - name: Run Trivy scan
        uses: aquasecurity/trivy-action@master
        with:
          scan-type: fs
          scan-ref: .
          severity: HIGH,CRITICAL

      - name: OWASP Dependency Check
        uses: dependency-check/Dependency-Check_Action@main
        with:
          project: secrets-portal
          path: .
          format: JSON

      - name: Upload SARIF
        uses: github/codeql-action/upload-sarif@v2
        with:
          sarif_file: ./dependency-check-report.sarif
